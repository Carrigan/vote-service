<div id="loading" class="hidden">
  <img src="http://reactiongifs.me/wp-content/uploads/2013/08/at-work-cookie-monster.gif">
</div>

<div id="create_new">
  <h3>Create a new election</h3>
  <p>To create a new election, create candidates and then click the Create Election button.</p>

  <div class="form-group">
    <label for="usr">Election Name</label>
    <input type="text" class="form-control" id="election_name">
  </div>

  <div class="form-group">
    <label for="usr">Seat Count</label>
    <input type="text" class="form-control" id="seat_count">
  </div>

  <h4>Candidates</h4>
  <div id="inputs_div" class="space-bottom"></div>
  <button id="more_candidates" class="btn btn-primary">Add Another Candidate</button>
  <button id='new_button' class="btn btn-primary">Create Election</button>
</div>

<div id="election_created" class="hidden">
  <h3>Success!</h3>
  <p>Your election has been created and can be found at the following link: <a id="election-link"></a>.
  <h3>Finish this election</h3>
  <p>In order to finish this election, simply click on the following button and we will tabulate and display your
     election's results.</p>
  <button id='close-button' class="btn btn-primary">Close Election</button>
</div>

<script>
var app = require("web/static/js/app").VoteApp;
var close_link;
var election_id;

var close_success = function() {
  window.location.href = "/results/" + election_id;
}

var close_failure = function() {
  console.log("Add an error handler here please!");
}

$('#close-button').click(function() {
  app.close_election(close_link, close_success, close_failure);
});

var success_handler = function(data) {
  $('#loading').addClass('hidden');
  $('#election_created').removeClass('hidden');

  election_id = data.data.id;
  close_link = data.data.close_url;
  var election_link = '/vote/' + data.data.id;

  $('#election-link').attr('href', election_link);
  $('#election-link').text(election_link);
}

var failure_handler = function(data) {
  $('#loading').addClass('hidden');
  $('#create_new').removeClass('hidden');
}

var create_new_candidate = function() {
  var container = $('#inputs_div');
  container.append("<input type='text' class='form-control space-bottom'>");
}

create_new_candidate();

$('#more_candidates').click(function() {
  create_new_candidate();
});

$('#new_button').click(function() {
  $('#create_new').addClass('hidden');
  $('#election_created').addClass('hidden');
  $('#loading').removeClass('hidden');

  var name = $('#election_name').val();
  var seats = $('#seat_count').val();
  var candidates = $.map($('#inputs_div :input'), function(input) { return $(input).val() });
  app.make_election(candidates, name, seats, success_handler, failure_handler);
});

</script>